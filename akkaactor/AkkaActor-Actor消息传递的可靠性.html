<!DOCTYPE html><html lang="zh-cmn-Hans" prefix="og: http://ogp.me/ns#" class="han-init"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" /><title>Actor消息传递的可靠性 &mdash; 梦境迷离</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jxnu-liguobin/jxnu-liguobin.github.io@master/assets/vendor/primer-css/css/primer.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jxnu-liguobin/jxnu-liguobin.github.io@master/assets/css/components/collection.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jxnu-liguobin/jxnu-liguobin.github.io@master/assets/css/components/repo-card.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jxnu-liguobin/jxnu-liguobin.github.io@master/assets/css/sections/repo-list.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jxnu-liguobin/jxnu-liguobin.github.io@master/assets/css/components/boxed-group.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jxnu-liguobin/jxnu-liguobin.github.io@master/assets/css/globals/common.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jxnu-liguobin/jxnu-liguobin.github.io@master/assets/css/globals/responsive.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jxnu-liguobin/jxnu-liguobin.github.io@master/assets/css/posts/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jxnu-liguobin/jxnu-liguobin.github.io@master/assets/vendor/octicons/octicons/octicons.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/mzlogin/rouge-themes@master/dist/github.css"><link rel="canonical" href="https://dreamylost.cn/akkaactor/AkkaActor-Actor%E6%B6%88%E6%81%AF%E4%BC%A0%E9%80%92%E7%9A%84%E5%8F%AF%E9%9D%A0%E6%80%A7.html"><link rel="alternate" type="application/atom+xml" title="梦境迷离" href="https://dreamylost.cn/feed.xml"><link rel="shortcut icon" href="https://dreamylost.cn/favicon.ico"><meta property="og:title" content="Actor消息传递的可靠性"><meta name="keywords" content="梦境迷离, jxnu-liguobin"><meta name="og:keywords" content="梦境迷离, jxnu-liguobin"><meta name="description" content=""><meta name="og:description" content=""><meta property="og:url" content="https://dreamylost.cn/akkaactor/AkkaActor-Actor%E6%B6%88%E6%81%AF%E4%BC%A0%E9%80%92%E7%9A%84%E5%8F%AF%E9%9D%A0%E6%80%A7.html"><meta property="og:site_name" content="梦境迷离"><meta property="og:type" content="article"><meta property="og:locale" content="zh_CN" /><meta property="article:published_time" content="2019-10-15"> <script src="https://cdn.jsdelivr.net/gh/jxnu-liguobin/jxnu-liguobin.github.io@master/assets/vendor/jquery/dist/jquery.min.js"></script> <script src="https://cdn.jsdelivr.net/gh/jxnu-liguobin/jxnu-liguobin.github.io@master/assets/js/jquery-ui.js"></script> <script src="https://cdn.jsdelivr.net/gh/jxnu-liguobin/jxnu-liguobin.github.io@master/assets/js/main.js"></script> <script data-ad-client="ca-pub-8236444920328818" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script></head><body class="" data-mz=""><header class="site-header"><div class="container"><h1><a href="https://dreamylost.cn/" title="梦境迷离"><span class="octicon octicon-mark-github"></span> 梦境迷离</a></h1><button class="collapsed mobile-visible" type="button" onclick="toggleMenu();"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button><nav class="site-header-nav" role="navigation"> <a href="https://dreamylost.cn/" class=" site-header-nav-item" target="" title="首页">首页</a> <a href="https://dreamylost.cn/categories/" class=" site-header-nav-item" target="" title="分类">分类</a> <a href="https://dreamylost.cn/wiki/" class=" site-header-nav-item" target="" title="维基">维基</a> <a href="https://dreamylost.cn/links/" class=" site-header-nav-item" target="" title="链接">链接</a> <a href="https://dreamylost.cn/about/" class=" site-header-nav-item" target="" title="关于">关于</a></nav></div></header><section class="collection-head small geopattern" data-pattern-id="Actor消息传递的可靠性"><div class="container"><div class="columns"><div class="column three-fourths"><div class="collection-title"><h1 class="collection-header">Actor消息传递的可靠性</h1><div class="collection-info"> <span class="meta-info"> <span class="octicon octicon-calendar"></span> 2019/10/15 </span> <span class="meta-info"> <span class="octicon octicon-file-directory"></span> <a href="https://dreamylost.cn/categories/#AkkaActor" title="AkkaActor">AkkaActor</a> </span> <span class="meta-info"> <span class="octicon octicon-clock"></span> 共 2334 字，约 7 分钟 </span></div></div></div><div class="column one-fourth mobile-hidden"><div class="collection-title"> <img style="height:72px;width:72px" src="https://cdn.jsdelivr.net/gh/jxnu-liguobin/jxnu-liguobin.github.io@master/assets/images/qrcode.jpg" alt="梦境迷离" /></div></div></div></div></section><section class="container content"><div class="columns"><div class="column three-fourths" > <ins class="adsbygoogle content-header-ad" data-ad-client="ca-pub-8236444920328818" data-ad-slot="3977594606"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script> <br /><article class="article-content markdown-body"><ul id="markdown-toc"><li><a href="#一般性规则简述" id="markdown-toc-一般性规则简述">一般性规则简述</a></li><li><a href="#讨论最多一次是什么意思" id="markdown-toc-讨论最多一次是什么意思">讨论：“最多一次”是什么意思</a></li><li><a href="#讨论为什么没有保证交付" id="markdown-toc-讨论为什么没有保证交付">讨论：为什么没有保证交付</a></li><li><a href="#讨论消息排序" id="markdown-toc-讨论消息排序">讨论：消息排序</a></li><li><a href="#失败的通信" id="markdown-toc-失败的通信">失败的通信</a></li></ul><p>为了给下面的讨论提供一些上下文，请考虑一个跨越多个网络主机的应用程序。 无论是发送到本地JVM上的参与者还是向远程参与者发送，通信的基本机制是相同的，但是在传递延迟（可能还取决于网络链路的带宽和消息大小）和可靠性方面会有明显的差异。 在远程消息发送的情况下，需要执行更多的步骤，这意味着更多的步骤可能出错。 另一个方面是，本地发送将在同一个JVM中传递对消息的引用，对所发送的底层对象没有任何限制，而远程传输将限制消息大小。</p><p>编写actor的安全方式，是假设每一个通信可能是远程的，即做一个悲观的赌注。这意味着只依赖那些始终得到保证并在下文中详细讨论的属性。这在actor的实现中有一些开销。 如果您愿意牺牲充分的位置透明性-例如，在一组密切协作的actor的情况下-您可以始终将它们放在同一个JVM上，并在消息传递方面享有更严格的保证。</p><h4 id="一般性规则简述">一般性规则简述</h4><p>这些是消息发送的规则（即tell或!方法，该方法也是ask（模式）下的基础）：</p><ul><li>最多一次发送，即没有保证发送</li><li>每个（发送方-接收方）对是排序的</li></ul><p>第一个规则通常也可以在其他actor实现中找到，而第二个规则是特定于Akka的。</p><h4 id="讨论最多一次是什么意思">讨论：“最多一次”是什么意思</h4><p>在描述传递机制的语义时，有三个基本类别：</p><ul><li>最多一次传递意味着，对于发送给该actor的每一条消息，该消息只发送一次或根本不发送；更随意地说，这意味着消息可能丢失。</li><li>至少一次传递意味着，对于发送给该actor的每一条消息，可能会多次尝试发送，因此至少有一条成功；同样，以更随意的方式来说，这意味着消息可能会重复，但不会丢失。</li><li>一次传递意味着，对于发送给该actor的每一条消息，都会向接收方进行一次传递；该消息既不能丢失，也不能重复。</li></ul><p>第一个是最低代价的-最高的性能，即最少的实施开销，因为它可以一劳永逸的方式完成，而无需在发送端或传输机制中保持状态。 第二个要求重试以抵消传输损失，这意味着在发送端保持状态并在接收端具有确认机制。 第三种是最昂贵的，并且因此具有最差的性能，因为除了第二种之外，它还要求状态保持在接收端，以过滤出重复传递的消息。</p><p>这里delivery可能理解为交付、交出更好</p><h4 id="讨论为什么没有保证交付">讨论：为什么没有保证交付</h4><p>问题的核心在于这样的保证究竟意味着什么：</p><ul><li>消息是在网络上发送的吗？</li><li>消息被另一个主机接收了吗？</li><li>消息被放入目标actor的信箱中了吗？</li><li>消息开始由目标actor处理了吗？</li><li>消息被目标actor成功地处理了吗？</li></ul><p>其中每一个都有不同的挑战和成本，很明显，在某些条件下，任何消息传递库都无法满足要求； 例如，考虑一下可配置的信箱类型，一个有界的信箱将如何与第三方交互，甚至决定第五点的“成功”部分意味着什么。</p><p>按照同样的思路，<a href="https://www.infoq.com/articles/no-reliable-messaging/">没有人需要可靠的消息传递</a>。对于发送者来说，了解交互是否成功的唯一有意义的方法是接收一条业务级别的确认消息，这不是akka可以自己弥补的。</p><p>Akka采用分布式计算，并通过消息传递使通信的错误性变得明确，因此它不试图欺骗和模拟泄漏的抽象。这是一个在Erlang中非常成功地使用的模型，并且要求用户围绕它设计他们的应用程序。您可以在<a href="http://www.erlang.org/faq/academic.html">Erlang文档 第10.9节和第10.10节</a>中更多地了解这种方法。</p><p>关于这个问题的另一个角度是，通过仅提供基本保证，那些不需要更强可靠性的用例就无需支付实施成本。总是有可能在基本的基础上增加更强的可靠性，但是不可能追溯性地删除可靠性以获得更多性能。</p><h4 id="讨论消息排序">讨论：消息排序</h4><p>更具体地说，规则是对于给定的一对actor，从第一个到第二个直接发送的消息不会被无序接收。这个词直接强调，此保证仅在与tell运算符一起发送到最终目的地时才适用，而不在使用中介程序或其他消息分发功能时适用（除非另有说明）。</p><p>保证说明如下：</p><ul><li>actor A1 向 actor A2 发送消息 M1, M2, M3</li><li>actor A3 向 actor A2 发送消息 M4, M5, M6</li></ul><p>这意味着：</p><ol><li>如果M1交付，则必须在M2和M3之前交付</li><li>如果M2交付，则必须在M3之前交付</li><li>如果M4已交付，则必须在M5和M6之前交付</li><li>如果M5已交付，则必须在M6之前交付</li><li>A2可以看到来自A1的消息与来自A3的消息交错</li><li>由于没有保证交付，任何消息都可能被丢弃，即不能到达A2</li></ol><p>如果邮箱实现不遵守FIFO顺序（例如PriorityMailbox），则actor的处理顺序会偏离排队顺序。</p><p>但请注意，这一规则不具有传递性：</p><ul><li>actor A 向 actor C 发送消息 M1</li><li>actor A 向 actor B 发送消息 M2</li><li>actor B 将消息 M2 转发给 actor C</li><li>actor C 可以按任意顺序接收 M1 和 M2</li></ul><p>如果遵守传递性，则意味着M2不会在M1被actor C收到之前被接收到（尽管其中任何一个都可能丢失）。当A、B和C在不同的网络主机上时，由于消息传递延迟不同，此顺序可能会被违反，请参阅下面的更多信息。</p><h4 id="失败的通信">失败的通信</h4><p>上面讨论的排序保证只适用于actor之间的用户消息。actor的子程序的故障传递的是特定的系统消息，这些消息相对于普通的用户消息而言是不被排序的。特别是：</p><ul><li>子 actor C 向其父P发送消息M</li><li>子 actor 以故障F失败</li><li>父 actor P可能按顺序M、F或F、M接收这两个事件</li></ul><p>原因是内部系统消息具有自己的邮箱，因此用户入队调用的顺序和系统消息不能保证其出队时间的顺序。</p><p>这里仅有一般性规则的说明，如有不理解或更多高级规则可参看<a href="https://doc.akka.io/docs/akka/current/general/message-delivery-reliability.html">官方文档 Message Delivery Reliability</a></p><ul><li>使用搜狗翻译、百度翻译、谷歌翻译，仅供参考</li><li>来自官方文档、参考《响应式架构 消息模式Actor实现与Scala、Akka应用集成》</li><li>后续随着理解深入会继续修改错误和描述，以便更好理解，本博客开源，欢迎指出错误</li></ul><div style="margin-top:2em;padding:0 1.5em;border:1px solid #d3d3d3;background-color:#deebf7"><h3>文档信息</h3><ul><li>本文作者：<a href="https://dreamylost.cn" target="_blank">梦境迷离</a></li><li>本文链接：<a href="https://dreamylost.cn/akkaactor/AkkaActor-Actor%E6%B6%88%E6%81%AF%E4%BC%A0%E9%80%92%E7%9A%84%E5%8F%AF%E9%9D%A0%E6%80%A7.html" target="_blank">https://dreamylost.cn/akkaactor/AkkaActor-Actor%E6%B6%88%E6%81%AF%E4%BC%A0%E9%80%92%E7%9A%84%E5%8F%AF%E9%9D%A0%E6%80%A7.html</a></li><li>版权声明：自由转载-非商用-非衍生-保持署名（<a href="http://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh" target="_blank">创意共享3.0许可证</a>）</li></ul></div></article><div class="share"></div><div class="comment"><div id="gitalk-container"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jxnu-liguobin/jxnu-liguobin.github.io@master/assets/vendor/gitalk/gitalk.css"> <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script> <script> var gitalk = new Gitalk({ id: '/akkaactor/AkkaActor-Actor%E6%B6%88%E6%81%AF%E4%BC', clientID: '061aadb5d449c0877d7d', clientSecret: '9aa7af7c248a7e36a07a86993e11a7acf7fbd353', repo: 'dreamylost-comments', owner: 'jxnu-liguobin', admin: ['jxnu-liguobin'], labels: ['gitment'], perPage: 50, }); gitalk.render('gitalk-container'); </script></div></div><div class="column one-fourth"><h3>Search</h3><div id="site_search"> <input style="width:96%" type="text" id="search_box" placeholder="Search"></div><ul id="search_results" style="font-size:14px;list-style-type:none;padding-top:10px;padding-left:10px;"></ul><script src="https://cdn.jsdelivr.net/gh/jxnu-liguobin/jxnu-liguobin.github.io@master/assets/js/simple-jekyll-search.min.js"></script> <script type="text/javascript"> SimpleJekyllSearch({ searchInput: document.getElementById('search_box'), resultsContainer: document.getElementById('search_results'), json: 'https://cdn.jsdelivr.net/gh/jxnu-liguobin/jxnu-liguobin.github.io@built/assets/search_data.json?v=1622701634', searchResultTemplate: '<li><a href="{url}" title="{title}">{title}</a></li>', noResultsText: 'No results found', limit: 10, fuzzy: false, exclude: ['Welcome'] }) </script><h3 class="post-directory-title mobile-hidden">Table of Contents</h3><div id="post-directory-module" class="mobile-hidden"><section class="post-directory"><dl></dl></section></div><script src="https://cdn.jsdelivr.net/gh/jxnu-liguobin/jxnu-liguobin.github.io@master/assets/js/jquery.toc.js"></script></div></div></section><footer class="container"> <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-8236444920328818" data-ad-slot="6220614560" data-ad-format="auto" data-full-width-responsive="true"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script><div class="site-footer" role="contentinfo"><div class="copyright left mobile-block"> © 2019 <span title="梦境迷离">梦境迷离</span> <a href="http://www.beian.miit.gov.cn/publish/query/indexFirst.action" rel="nofollow" target="_blank">赣ICP备17017283号-1</a> <a href="javascript:window.scrollTo(0,0)" class="right mobile-visible">TOP</a></div><ul class="site-footer-links right mobile-hidden"><li> <a href="javascript:window.scrollTo(0,0)" >TOP</a></li></ul><a href="https://github.com/jxnu-liguobin/jxnu-liguobin.github.io" target="_blank" aria-label="view source code"> <span class="mega-octicon octicon-mark-github" title="GitHub"></span> </a><ul class="site-footer-links mobile-hidden"><li> <a href="https://dreamylost.cn/" title="首页" target="">首页</a></li><li> <a href="https://dreamylost.cn/categories/" title="分类" target="">分类</a></li><li> <a href="https://dreamylost.cn/wiki/" title="维基" target="">维基</a></li><li> <a href="https://dreamylost.cn/links/" title="链接" target="">链接</a></li><li> <a href="https://dreamylost.cn/about/" title="关于" target="">关于</a></li><li><a href="https://dreamylost.cn/feed.xml"><span class="octicon octicon-rss" style="color:orange;"></span></a></li></ul><script async src="https://cdn.jsdelivr.net/gh/jxnu-liguobin/jxnu-liguobin.github.io@master/assets/vendor/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="mobile-hidden" style="margin-top:8px"> <span id="busuanzi_container_site_pv" style="display:none"> 本站访问量<span id="busuanzi_value_site_pv"></span>次 </span> <span id="busuanzi_container_site_uv" style="display:none"> / 本站访客数<span id="busuanzi_value_site_uv"></span>人 </span> <span id="busuanzi_container_page_pv" style="display:none"> / 本页访问量<span id="busuanzi_value_page_pv"></span>次 / 统计始于2019-09-20 </span></div></div></footer><div class="tools-wrapper"> <a class="gotop" href="#" title="回到顶部"><span class="octicon octicon-arrow-up"></span></a></div><script src="https://cdn.jsdelivr.net/gh/jxnu-liguobin/jxnu-liguobin.github.io@master/assets/js/geopattern.js"></script> <script> jQuery(document).ready(function($) { $('.geopattern').each(function(){ $(this).geopattern($(this).data('pattern-id')); }); /* hljs.initHighlightingOnLoad(); */ }); </script><div style="display:none"> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','https://www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-147390701-1', 'auto'); ga('send', 'pageview'); </script></div></body></html>
