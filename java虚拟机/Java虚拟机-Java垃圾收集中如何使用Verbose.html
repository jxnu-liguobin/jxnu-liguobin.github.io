<!DOCTYPE html><html lang="zh-cmn-Hans" prefix="og: http://ogp.me/ns#" class="han-init"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" /><title>Java垃圾收集中如何使用Verbose &mdash; 梦境迷离</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jxnu-liguobin/jxnu-liguobin.github.io@master/assets/vendor/primer-css/css/primer.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jxnu-liguobin/jxnu-liguobin.github.io@master/assets/css/components/collection.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jxnu-liguobin/jxnu-liguobin.github.io@master/assets/css/components/repo-card.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jxnu-liguobin/jxnu-liguobin.github.io@master/assets/css/sections/repo-list.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jxnu-liguobin/jxnu-liguobin.github.io@master/assets/css/components/boxed-group.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jxnu-liguobin/jxnu-liguobin.github.io@master/assets/css/globals/common.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jxnu-liguobin/jxnu-liguobin.github.io@master/assets/css/globals/responsive.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jxnu-liguobin/jxnu-liguobin.github.io@master/assets/css/posts/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jxnu-liguobin/jxnu-liguobin.github.io@master/assets/vendor/octicons/octicons/octicons.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/mzlogin/rouge-themes@master/dist/github.css"><link rel="canonical" href="https://dreamylost.cn/java%E8%99%9A%E6%8B%9F%E6%9C%BA/Java%E8%99%9A%E6%8B%9F%E6%9C%BA-Java%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E4%B8%AD%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8Verbose.html"><link rel="alternate" type="application/atom+xml" title="梦境迷离" href="https://dreamylost.cn/feed.xml"><link rel="shortcut icon" href="https://dreamylost.cn/favicon.ico"><meta property="og:title" content="Java垃圾收集中如何使用Verbose"><meta name="keywords" content="梦境迷离, jxnu-liguobin"><meta name="og:keywords" content="梦境迷离, jxnu-liguobin"><meta name="description" content=""><meta name="og:description" content=""><meta property="og:url" content="https://dreamylost.cn/java%E8%99%9A%E6%8B%9F%E6%9C%BA/Java%E8%99%9A%E6%8B%9F%E6%9C%BA-Java%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E4%B8%AD%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8Verbose.html"><meta property="og:site_name" content="梦境迷离"><meta property="og:type" content="article"><meta property="og:locale" content="zh_CN" /><meta property="article:published_time" content="2020-10-19"> <script src="https://cdn.jsdelivr.net/gh/jxnu-liguobin/jxnu-liguobin.github.io@master/assets/vendor/jquery/dist/jquery.min.js"></script> <script src="https://cdn.jsdelivr.net/gh/jxnu-liguobin/jxnu-liguobin.github.io@master/assets/js/jquery-ui.js"></script> <script src="https://cdn.jsdelivr.net/gh/jxnu-liguobin/jxnu-liguobin.github.io@master/assets/js/main.js"></script> <script data-ad-client="ca-pub-8236444920328818" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script></head><body class="" data-mz=""><header class="site-header"><div class="container"><h1><a href="https://dreamylost.cn/" title="梦境迷离"><span class="octicon octicon-mark-github"></span> 梦境迷离</a></h1><button class="collapsed mobile-visible" type="button" onclick="toggleMenu();"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button><nav class="site-header-nav" role="navigation"> <a href="https://dreamylost.cn/" class=" site-header-nav-item" target="" title="首页">首页</a> <a href="https://dreamylost.cn/categories/" class=" site-header-nav-item" target="" title="分类">分类</a> <a href="https://dreamylost.cn/wiki/" class=" site-header-nav-item" target="" title="维基">维基</a> <a href="https://dreamylost.cn/links/" class=" site-header-nav-item" target="" title="链接">链接</a> <a href="https://dreamylost.cn/about/" class=" site-header-nav-item" target="" title="关于">关于</a></nav></div></header><section class="collection-head small geopattern" data-pattern-id="Java垃圾收集中如何使用Ve"><div class="container"><div class="columns"><div class="column three-fourths"><div class="collection-title"><h1 class="collection-header">Java垃圾收集中如何使用Verbose</h1><div class="collection-info"> <span class="meta-info"> <span class="octicon octicon-calendar"></span> 2020/10/19 </span> <span class="meta-info"> <span class="octicon octicon-file-directory"></span> <a href="https://dreamylost.cn/categories/#Java虚拟机" title="Java虚拟机">Java虚拟机</a> </span> <span class="meta-info"> <span class="octicon octicon-clock"></span> 共 6473 字，约 19 分钟 </span></div></div></div><div class="column one-fourth mobile-hidden"><div class="collection-title"> <img style="height:72px;width:72px" src="https://cdn.jsdelivr.net/gh/jxnu-liguobin/jxnu-liguobin.github.io@master/assets/images/qrcode.jpg" alt="梦境迷离" /></div></div></div></div></section><section class="container content"><div class="columns"><div class="column three-fourths" > <ins class="adsbygoogle content-header-ad" data-ad-client="ca-pub-8236444920328818" data-ad-slot="3977594606"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script> <br /><article class="article-content markdown-body"><ul id="markdown-toc"><li><a href="#总览" id="markdown-toc-总览">总览</a></li><li><a href="#垃圾收集中verbose的简单介绍" id="markdown-toc-垃圾收集中verbose的简单介绍">垃圾收集中Verbose的简单介绍</a><ul><li><a href="#一个简单的java程序" id="markdown-toc-一个简单的java程序">一个简单的Java程序</a></li></ul></li><li><a href="#启用简单的gc日志记录" id="markdown-toc-启用简单的gc日志记录">启用“简单”的GC日志记录</a><ul><li><a href="#对verbose输出的基本了解" id="markdown-toc-对verbose输出的基本了解">对Verbose输出的基本了解</a></li><li><a href="#verbose输出" id="markdown-toc-verbose输出">Verbose输出</a></li></ul></li><li><a href="#启用详细的gc日志记录" id="markdown-toc-启用详细的gc日志记录">启用“详细”的GC日志记录</a></li><li><a href="#解读详细的verbose输出" id="markdown-toc-解读详细的verbose输出">解读“详细”的Verbose输出</a><ul><li><a href="#在年轻代中解读minor-gc" id="markdown-toc-在年轻代中解读minor-gc">在年轻代中解读Minor GC</a></li><li><a href="#解读full-gc" id="markdown-toc-解读full-gc">解读Full GC</a></li><li><a href="#java堆故障分析" id="markdown-toc-java堆故障分析">Java堆故障分析</a></li></ul></li><li><a href="#添加日期和时间信息" id="markdown-toc-添加日期和时间信息">添加日期和时间信息</a></li><li><a href="#记录到文件" id="markdown-toc-记录到文件">记录到文件</a></li><li><a href="#java-9-统一jvm日志记录" id="markdown-toc-java-9-统一jvm日志记录">Java 9: 统一JVM日志记录</a></li><li><a href="#分析gc日志的工具" id="markdown-toc-分析gc日志的工具">分析GC日志的工具</a></li></ul><h1 id="总览">总览</h1><blockquote><p>Verbose 冗长、详细；输出详细调试信息</p></blockquote><p>在本教程中，我们将研究如何在Java应用程序的垃圾收集中启用Verbose。我们将首先介绍什么是Verbose以及为何有用。</p><p>接下来，我们将看几个不同的示例，并了解可用的不同配置选项。此外，我们还将重点介绍如何解读Verbose的输出。</p><h1 id="垃圾收集中verbose的简单介绍">垃圾收集中Verbose的简单介绍</h1><p><strong>在调整和调试许多问题（尤其是内存问题）时，通常需要打开详细的垃圾收集日志记录。</strong> 实际上，有些人认为，为了严格监控我们的应用程序运行状况，我们应该始终监控JVM的垃圾收集状态。</p><p>就像我们将看到的那样，GC日志是一个非常重要的工具，它可以用于揭示对应用程序的堆和GC配置的潜在改进。<strong>对于每次GC的发生，GC日志都会提供有关其结果和持续时间的准确数据。</strong></p><p>随着时间的流逝，对此信息的分析可以帮助我们更好地了解应用程序的行为并帮助我们调整应用程序的性能。此外，<strong>它可以通过指定最佳堆大小，其他JVM选项和替代GC算法来帮助优化GC频率和收集时间。</strong></p><h2 id="一个简单的java程序">一个简单的Java程序</h2><p>我们将使用一个简单的Java程序来演示如何启用和解读我们的GC日志：</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Application</span> <span class="o">{</span>
 
    <span class="kd">private</span> <span class="kd">static</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">stringContainer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>
 
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Start of program!"</span><span class="o">);</span>
        <span class="nc">String</span> <span class="n">stringWithPrefix</span> <span class="o">=</span> <span class="s">"stringWithPrefix"</span><span class="o">;</span>
 
        <span class="c1">// Load Java Heap with 3 M java.lang.String instances</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">3000000</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="nc">String</span> <span class="n">newString</span> <span class="o">=</span> <span class="n">stringWithPrefix</span> <span class="o">+</span> <span class="n">i</span><span class="o">;</span>
            <span class="n">stringContainer</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">newString</span><span class="o">,</span> <span class="n">newString</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"MAP size: "</span> <span class="o">+</span> <span class="n">stringContainer</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>
 
        <span class="c1">// Explicit GC!</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">gc</span><span class="o">();</span>
 
        <span class="c1">// Remove 2 M out of 3 M</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">2000000</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="nc">String</span> <span class="n">newString</span> <span class="o">=</span> <span class="n">stringWithPrefix</span> <span class="o">+</span> <span class="n">i</span><span class="o">;</span>
            <span class="n">stringContainer</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">newString</span><span class="o">);</span>
        <span class="o">}</span>
 
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"MAP size: "</span> <span class="o">+</span> <span class="n">stringContainer</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"End of program!"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>如上例所示，这个简单的程序将300万个String实例加载到Map对象中。然后，我们使用<code class="language-plaintext highlighter-rouge">System.gc()</code>显式调用垃圾收集器。</p><p>最后，我们从Map中删除了200万个String实例。</p><p>在下一节中，我们将看到如何启用GC日志记录。</p><h1 id="启用简单的gc日志记录">启用“简单”的GC日志记录</h1><p>让我们开始运行程序，并通过JVM启动参数启用详细GC：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-XX:+UseSerialGC -Xms1024m -Xmx1024m -verbose:gc
</code></pre></div></div><p><strong>这里的重要参数是<code class="language-plaintext highlighter-rouge">-verbose:gc</code>，它以最简单的形式启用垃圾收集信息的记录。</strong> 默认情况下，GC日志写入到stdout，并且应该为每个young generation GC（Young GC）和每个full GC输出一行。</p><p>就我们的示例而言，我们通过参数<code class="language-plaintext highlighter-rouge">-XX:+UseSerialGC</code>指定了串行垃圾收集器，这是最简单的GC实现。</p><p>我们还将最小和最大堆大小设置为1024mb，当然，我们可以调整更多的JVM参数。</p><h2 id="对verbose输出的基本了解">对Verbose输出的基本了解</h2><p>现在让我们看一下我们的简单程序的输出：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Start of program!
[GC (Allocation Failure)  279616K-&gt;146232K(1013632K), 0.3318607 secs]
[GC (Allocation Failure)  425848K-&gt;295442K(1013632K), 0.4266943 secs]
MAP size: 3000000
[Full GC (System.gc())  434341K-&gt;368279K(1013632K), 0.5420611 secs]
[GC (Allocation Failure)  647895K-&gt;368280K(1013632K), 0.0075449 secs]
MAP size: 1000000
End of program!
</code></pre></div></div><p>在上面的输出中，我们已经可以看到很多有关JVM内部发生的有用信息。</p><p>起初，此输出看起来非常艰巨，但现在让我们逐步进行一下。</p><p>首先，<strong>我们可以看到发生了四个收集，一个full GC和三个young generation GC。</strong></p><h2 id="verbose输出">Verbose输出</h2><p>让我们更详细地分解输出行，以准确了解正在发生的事情：</p><ol><li>GC或Full GC – <strong>垃圾收集的类型，GC或Full GC可以区分次要垃圾收集或完整垃圾收集</strong></li><li>(分配失败)或(System.gc()) – 收集的原因 – <strong>“分配失败”表示在Eden区中没有剩余空间来分配我们的对象</strong></li><li>279616K-&gt;146232K - 分别表示在GC之前和之后的已占用堆内存（以箭头分隔）</li><li>(1013632K) – 堆的当前容量</li><li>0.3318607秒 – GC事件的持续时间（以秒为单位）</li></ol><p>因此，如果仅看第一行，则279616K-&gt;146232K(1013632K)意味着GC将占用的堆内存从279616K减少到146232K。GC时的堆容量为1013632K，GC花费了0.3318607秒。</p><p>但是，尽管简单的GC日志记录格式可能很有用，但它提供的信息有限。例如，<strong>我们无法确定GC是否将任何对象从年轻代移到了年老代，或者每次收集之前和之后年轻代的总大小是多少。</strong></p><p>因此，详细的GC记录比简单的记录更为有用。</p><h1 id="启用详细的gc日志记录">启用“详细”的GC日志记录</h1><p><strong>要启用详细的GC日志记录，我们使用参数<code class="language-plaintext highlighter-rouge">-XX:+PrintGCDetails</code>。</strong> 这将为我们提供有关每个GC的更多详细信息，例如：</p><ul><li>每次GC之前和之后的年轻代和年老代的大小</li><li>年轻代和年老代发生GC所需的时间</li><li>每次GC提升的对象的大小</li><li>总堆大小的摘要</li></ul><p>在下一个示例中，我们将结合使用<code class="language-plaintext highlighter-rouge">-verbose:gc</code>和这个额外的参数来了解如何在日志中捕获更详细的信息。</p><p>请注意，<code class="language-plaintext highlighter-rouge">-XX:+PrintGCDetails</code>标志在Java 9中已被弃用，以支持新的统一日志记录机制（稍后将对此进行详细介绍）。无论如何，<strong><code class="language-plaintext highlighter-rouge">-XX:+PrintGCDetails</code>的新等效项是<code class="language-plaintext highlighter-rouge">-Xlog:gc *</code>（Java8之前-Xloggc）选项。</strong></p><h1 id="解读详细的verbose输出">解读“详细”的Verbose输出</h1><p>让我们再次运行示例程序：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-XX:+UseSerialGC -Xms1024m -Xmx1024m -verbose:gc -XX:+PrintGCDetails
</code></pre></div></div><p>这次的输出更加详细：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Start of program!
[GC (Allocation Failure) [DefNew: 279616K-&gt;34944K(314560K), 0.3626923 secs] 279616K-&gt;146232K(1013632K), 0.3627492 secs] [Times: user=0.33 sys=0.03, real=0.36 secs] 
[GC (Allocation Failure) [DefNew: 314560K-&gt;34943K(314560K), 0.4589079 secs] 425848K-&gt;295442K(1013632K), 0.4589526 secs] [Times: user=0.41 sys=0.05, real=0.46 secs] 
MAP size: 3000000
[Full GC (System.gc()) [Tenured: 260498K-&gt;368281K(699072K), 0.5580183 secs] 434341K-&gt;368281K(1013632K), [Metaspace: 2624K-&gt;2624K(1056768K)], 0.5580738 secs] [Times: user=0.50 sys=0.06, real=0.56 secs] 
[GC (Allocation Failure) [DefNew: 279616K-&gt;0K(314560K), 0.0076722 secs] 647897K-&gt;368281K(1013632K), 0.0077169 secs] [Times: user=0.01 sys=0.00, real=0.01 secs] 
MAP size: 1000000
End of program!
Heap
 def new generation   total 314560K, used 100261K [0x00000000c0000000, 0x00000000d5550000, 0x00000000d5550000)
  eden space 279616K,  35% used [0x00000000c0000000, 0x00000000c61e9370, 0x00000000d1110000)
  from space 34944K,   0% used [0x00000000d3330000, 0x00000000d3330188, 0x00000000d5550000)
  to   space 34944K,   0% used [0x00000000d1110000, 0x00000000d1110000, 0x00000000d3330000)
 tenured generation   total 699072K, used 368281K [0x00000000d5550000, 0x0000000100000000, 0x0000000100000000)
   the space 699072K,  52% used [0x00000000d5550000, 0x00000000ebcf65e0, 0x00000000ebcf6600, 0x0000000100000000)
 Metaspace       used 2637K, capacity 4486K, committed 4864K, reserved 1056768K
  class space    used 283K, capacity 386K, committed 512K, reserved 1048576K
</code></pre></div></div><p>我们应该能够从简单的GC日志中识别所有元素。<strong>但是有几个新条目。</strong></p><p>现在让我们考虑输出中的新条目，这些新条目在下一节中以黑体突出显示：</p><h2 id="在年轻代中解读minor-gc">在年轻代中解读Minor GC</h2><p>我们将从分析Minor GC中的新条目开始：</p><ul><li>[GC (Allocation Failure) <strong>[DefNew: 279616K-&gt;34944K(314560K), 0.3626923 secs]</strong> 279616K-&gt;146232K(1013632K), 0.3627492 secs] <strong>[Times: user=0.33 sys=0.03, real=0.36 secs]</strong></li></ul><p>和以前一样，我们将这些行分成几部分：</p><ol><li>DefNew – 使用的垃圾收集器的名称。这个不太明显的名称代表单线程标记复制stop-the-world的垃圾收集器，它是用来收集年轻代的。</li><li>279616K-&gt;34944K – 收集前后年轻代的已占用堆内存大小</li><li>(314560K) – 年轻代的总大小</li><li>0.3626923秒 – 持续时间（秒）</li><li>[Times: user=0.33 sys=0.03, real=0.36 secs] – GC事件的持续时间，以不同类别衡量</li></ol><p>现在让我们解释不同的类别：</p><ul><li>user - 垃圾收集器消耗的总CPU时间</li><li>sys - 操作系统调用或等待系统事件所花费的时间</li><li>real - 这是消耗的时间总和，包括其他进程使用的时间片</li></ul><p><strong>由于我们的运行示例使用串行垃圾收集器（始终只使用一个线程），因此real-time等于用户（user）和系统时间（sys）的总和。</strong></p><h2 id="解读full-gc">解读Full GC</h2><p>在此倒数第二个示例中，我们看到，对于一个完整收集（Full GC）（由我们的系统调用触发），使用的收集器是Tenured（永久代）。</p><p>我们看到的最后一条附加信息是对元空间的相同模式的细分：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[Metaspace: 2624K-&gt;2624K(1056768K)], 0.5580738 secs]
</code></pre></div></div><p><strong>元空间是Java 8中引入的新内存空间，是本机内存的一个区域。</strong></p><h2 id="java堆故障分析">Java堆故障分析</h2><p><strong>输出的最后一部分包括堆的细分，包括每个内存部分的内存占用摘要。</strong></p><p>我们可以看到，Eden区占35％的空间，而Tenured占52％的空间。还包括元数据空间和类空间的摘要。</p><p>从上面的示例中，<strong>我们现在可以准确了解GC事件期间JVM内部的内存消耗情况。</strong></p><h1 id="添加日期和时间信息">添加日期和时间信息</h1><p>没有日期和时间信息的好日志是不完整的。</p><p><strong>当我们需要将GC日志数据与其他来源的数据相关联时，这些额外的信息可能非常有用，或者仅可以帮助您简化搜索。</strong></p><p>我们可以在运行应用程序时添加以下两个参数，以获取日期和时间信息以显示在日志中：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-XX:+PrintGCTimeStamps -XX:+PrintGCDateStamps
</code></pre></div></div><p>现在，每一行都以写入的绝对日期和时间开头，后跟一个时间戳，以反映自JVM启动以来经过的实时时间（以秒为单位）：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2018-12-11T02:55:23.518+0100: 2.601: [GC (Allocation ...
</code></pre></div></div><p>请注意，这些调整标志已在Java 9中删除。新的替代方法是：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-Xlog:gc*::time
</code></pre></div></div><h1 id="记录到文件">记录到文件</h1><p>正如我们已经看到的，默认情况下，GC日志被写入stdout。一个更实际的解决方案是指定一个输出文件。</p><p><strong>我们可以通过使用<code class="language-plaintext highlighter-rouge">-Xloggc:&lt;file&gt;</code>参数来实现，其中file是输出文件的绝对路径：</strong></p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-Xloggc:/path/to/file/gc.log
</code></pre></div></div><p>与其他调优标志类似，Java 9弃用了-Xloggc标志，以支持新的统一日志记录。更具体地说，现在记录到文件的替代方法是：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-Xlog:gc:/path/to/file/gc.log
</code></pre></div></div><h1 id="java-9-统一jvm日志记录">Java 9: 统一JVM日志记录</h1><p>从Java 9开始，不赞成使用大多数与GC相关的调整标志，而推荐使用统一日志记录选项<code class="language-plaintext highlighter-rouge">-Xlog:gc</code>。但是<code class="language-plaintext highlighter-rouge">-verbose:gc</code>选项仍然可以在Java 9和更高版本中使用。</p><p>例如，从Java 9开始，新的统一日志记录系统中的<code class="language-plaintext highlighter-rouge">-verbose:gc</code>标志等效于：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-Xlog:gc
</code></pre></div></div><p>这会将所有信息级别的GC日志记录到标准输出中。也可以使用<code class="language-plaintext highlighter-rouge">-Xlog:gc=&lt;level&gt;</code>语法来更改日志级别。例如，要查看所有调试级别的日志：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-Xlog:gc=debug
</code></pre></div></div><p>如前所述，我们可以通过<code class="language-plaintext highlighter-rouge">-Xlog:gc=&lt;level&gt;:&lt;output&gt;</code>语法更改输出目标。默认情况下，输出为stdout，但是我们可以将其更改为stderr甚至文件：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-Xlog:gc=debug:file=gc.txt
</code></pre></div></div><p>同样，可以使用装饰器在输出中添加更多字段。例如：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-Xlog:gc=debug::pid,time,uptime
</code></pre></div></div><p>在这里，我们在每个日志语句中打印进程ID，正常运行时间和当前时间戳。</p><p>要查看Unified JVM Logging的更多示例，请参阅<a href="https://openjdk.java.net/jeps/158">JEP 158标准</a>。</p><h1 id="分析gc日志的工具">分析GC日志的工具</h1><p>使用文本编辑器分析GC日志可能既耗时又繁琐。根据JVM版本和所使用的GC算法，GC日志格式可能会有所不同。</p><p>有一个很好的免费图形分析工具，可以分析垃圾收集日志，提供许多有关潜在垃圾收集问题的指标，甚至提供针对这些问题的潜在解决方案。<a href="https://gceasy.io/">通用GC日志分析仪</a>！</p><p><a href="https://www.baeldung.com/java-verbose-gc">Verbose Garbage Collection in Java</a></p><div style="margin-top:2em;padding:0 1.5em;border:1px solid #d3d3d3;background-color:#deebf7"><h3>文档信息</h3><ul><li>本文作者：<a href="https://dreamylost.cn" target="_blank">梦境迷离</a></li><li>本文链接：<a href="https://dreamylost.cn/java%E8%99%9A%E6%8B%9F%E6%9C%BA/Java%E8%99%9A%E6%8B%9F%E6%9C%BA-Java%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E4%B8%AD%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8Verbose.html" target="_blank">https://dreamylost.cn/java%E8%99%9A%E6%8B%9F%E6%9C%BA/Java%E8%99%9A%E6%8B%9F%E6%9C%BA-Java%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E4%B8%AD%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8Verbose.html</a></li><li>版权声明：自由转载-非商用-非衍生-保持署名（<a href="http://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh" target="_blank">创意共享3.0许可证</a>）</li></ul></div></article><div class="share"></div><div class="comment"><div id="gitalk-container"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jxnu-liguobin/jxnu-liguobin.github.io@master/assets/vendor/gitalk/gitalk.css"> <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script> <script> var gitalk = new Gitalk({ id: '/java%E8%99%9A%E6%8B%9F%E6%9C%BA/Java%E8%99%9A%E6%', clientID: '061aadb5d449c0877d7d', clientSecret: '9aa7af7c248a7e36a07a86993e11a7acf7fbd353', repo: 'dreamylost-comments', owner: 'jxnu-liguobin', admin: ['jxnu-liguobin'], labels: ['gitment'], perPage: 50, }); gitalk.render('gitalk-container'); </script></div></div><div class="column one-fourth"><h3>Search</h3><div id="site_search"> <input style="width:96%" type="text" id="search_box" placeholder="Search"></div><ul id="search_results" style="font-size:14px;list-style-type:none;padding-top:10px;padding-left:10px;"></ul><script src="https://cdn.jsdelivr.net/gh/jxnu-liguobin/jxnu-liguobin.github.io@master/assets/js/simple-jekyll-search.min.js"></script> <script type="text/javascript"> SimpleJekyllSearch({ searchInput: document.getElementById('search_box'), resultsContainer: document.getElementById('search_results'), json: 'https://cdn.jsdelivr.net/gh/jxnu-liguobin/jxnu-liguobin.github.io@built/assets/search_data.json?v=1617770394', searchResultTemplate: '<li><a href="{url}" title="{title}">{title}</a></li>', noResultsText: 'No results found', limit: 10, fuzzy: false, exclude: ['Welcome'] }) </script><h3 class="post-directory-title mobile-hidden">Table of Contents</h3><div id="post-directory-module" class="mobile-hidden"><section class="post-directory"><dl></dl></section></div><script src="https://cdn.jsdelivr.net/gh/jxnu-liguobin/jxnu-liguobin.github.io@master/assets/js/jquery.toc.js"></script></div></div></section><footer class="container"> <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-8236444920328818" data-ad-slot="6220614560" data-ad-format="auto" data-full-width-responsive="true"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script><div class="site-footer" role="contentinfo"><div class="copyright left mobile-block"> © 2019 <span title="梦境迷离">梦境迷离</span> <a href="http://www.beian.miit.gov.cn/publish/query/indexFirst.action" rel="nofollow" target="_blank">赣ICP备17017283号-1</a> <a href="javascript:window.scrollTo(0,0)" class="right mobile-visible">TOP</a></div><ul class="site-footer-links right mobile-hidden"><li> <a href="javascript:window.scrollTo(0,0)" >TOP</a></li></ul><a href="https://github.com/jxnu-liguobin/jxnu-liguobin.github.io" target="_blank" aria-label="view source code"> <span class="mega-octicon octicon-mark-github" title="GitHub"></span> </a><ul class="site-footer-links mobile-hidden"><li> <a href="https://dreamylost.cn/" title="首页" target="">首页</a></li><li> <a href="https://dreamylost.cn/categories/" title="分类" target="">分类</a></li><li> <a href="https://dreamylost.cn/wiki/" title="维基" target="">维基</a></li><li> <a href="https://dreamylost.cn/links/" title="链接" target="">链接</a></li><li> <a href="https://dreamylost.cn/about/" title="关于" target="">关于</a></li><li><a href="https://dreamylost.cn/feed.xml"><span class="octicon octicon-rss" style="color:orange;"></span></a></li></ul><script async src="https://cdn.jsdelivr.net/gh/jxnu-liguobin/jxnu-liguobin.github.io@master/assets/vendor/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="mobile-hidden" style="margin-top:8px"> <span id="busuanzi_container_site_pv" style="display:none"> 本站访问量<span id="busuanzi_value_site_pv"></span>次 </span> <span id="busuanzi_container_site_uv" style="display:none"> / 本站访客数<span id="busuanzi_value_site_uv"></span>人 </span> <span id="busuanzi_container_page_pv" style="display:none"> / 本页访问量<span id="busuanzi_value_page_pv"></span>次 / 统计始于2019-09-20 </span></div></div></footer><div class="tools-wrapper"> <a class="gotop" href="#" title="回到顶部"><span class="octicon octicon-arrow-up"></span></a></div><script src="https://cdn.jsdelivr.net/gh/jxnu-liguobin/jxnu-liguobin.github.io@master/assets/js/geopattern.js"></script> <script> jQuery(document).ready(function($) { $('.geopattern').each(function(){ $(this).geopattern($(this).data('pattern-id')); }); /* hljs.initHighlightingOnLoad(); */ }); </script><div style="display:none"> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','https://www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-147390701-1', 'auto'); ga('send', 'pageview'); </script></div></body></html>
