<!DOCTYPE html><html lang="zh-cmn-Hans" prefix="og: http://ogp.me/ns#" class="han-init"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" /><title>Linux命令 &mdash; 梦境迷离</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jxnu-liguobin/jxnu-liguobin.github.io@master/assets/vendor/primer-css/css/primer.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jxnu-liguobin/jxnu-liguobin.github.io@master/assets/css/components/collection.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jxnu-liguobin/jxnu-liguobin.github.io@master/assets/css/components/repo-card.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jxnu-liguobin/jxnu-liguobin.github.io@master/assets/css/sections/repo-list.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jxnu-liguobin/jxnu-liguobin.github.io@master/assets/css/components/boxed-group.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jxnu-liguobin/jxnu-liguobin.github.io@master/assets/css/globals/common.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jxnu-liguobin/jxnu-liguobin.github.io@master/assets/css/globals/responsive.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jxnu-liguobin/jxnu-liguobin.github.io@master/assets/css/posts/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jxnu-liguobin/jxnu-liguobin.github.io@master/assets/vendor/octicons/octicons/octicons.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/mzlogin/rouge-themes@master/dist/github.css"><link rel="canonical" href="https://blog.dreamylost.cn/wiki/Linux%E5%91%BD%E4%BB%A4/"><link rel="alternate" type="application/atom+xml" title="梦境迷离" href="https://blog.dreamylost.cn/feed.xml"><link rel="shortcut icon" href="https://dreamylost.cn/favicon.ico"><meta property="og:title" content="Linux命令"><meta name="keywords" content="梦境迷离, jxnu-liguobin"><meta name="og:keywords" content="梦境迷离, jxnu-liguobin"><meta name="description" content=""><meta name="og:description" content=""><meta property="og:url" content="https://blog.dreamylost.cn/wiki/Linux%E5%91%BD%E4%BB%A4/"><meta property="og:site_name" content="梦境迷离"><meta property="og:type" content="article"><meta property="og:locale" content="zh_CN" /><meta property="article:published_time" content="2023-12-19"> <script src="https://cdn.jsdelivr.net/gh/jxnu-liguobin/jxnu-liguobin.github.io@master/assets/vendor/jquery/dist/jquery.min.js"></script> <script src="https://cdn.jsdelivr.net/gh/jxnu-liguobin/jxnu-liguobin.github.io@master/assets/js/jquery-ui.js"></script> <script src="https://cdn.jsdelivr.net/gh/jxnu-liguobin/jxnu-liguobin.github.io@master/assets/js/main.js"></script> <script data-ad-client="ca-pub-8236444920328818" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script></head><body class="" data-mz=""><header class="site-header"><div class="container"><h1><a href="https://blog.dreamylost.cn/" title="梦境迷离"><span class="octicon octicon-mark-github"></span> 梦境迷离</a></h1><button class="collapsed mobile-visible" type="button" onclick="toggleMenu();"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button><nav class="site-header-nav" role="navigation"> <a href="https://blog.dreamylost.cn/" class=" site-header-nav-item" target="" title="首页">首页</a> <a href="https://blog.dreamylost.cn/categories/" class=" site-header-nav-item" target="" title="分类">分类</a> <a href="https://blog.dreamylost.cn/archives/" class=" site-header-nav-item" target="" title="归档">归档</a> <a href="https://blog.dreamylost.cn/open-source/" class=" site-header-nav-item" target="" title="开源">开源</a> <a href="https://blog.dreamylost.cn/wiki/" class=" site-header-nav-item" target="" title="维基">维基</a> <a href="https://blog.dreamylost.cn/links/" class=" site-header-nav-item" target="" title="链接">链接</a> <a href="https://blog.dreamylost.cn/about/" class=" site-header-nav-item" target="" title="关于">关于</a></nav></div></header><section class="collection-head small geopattern" data-pattern-id="Linux命令"><div class="container"><div class="columns"><div class="column three-fourths"><div class="collection-title"><h1 class="collection-header">Linux命令</h1></div></div><div class="column one-fourth mobile-hidden"> <img style="height:72px;width:72px" src="https://cdn.jsdelivr.net/gh/jxnu-liguobin/jxnu-liguobin.github.io@master/assets/images/qrcode.jpg" alt="梦境迷离" /></div></div></div></section><section class="container content"><div class="columns"><div class="column three-fourths" > <ins class="adsbygoogle content-header-ad" data-ad-client="ca-pub-8236444920328818" data-ad-slot="3977594606"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script> <br /><article class="article-content markdown-body"><ul id="markdown-toc"><li><a href="#工作环境设置文件与环境变量" id="markdown-toc-工作环境设置文件与环境变量">工作环境设置文件与环境变量</a></li><li><a href="#linux常用命令" id="markdown-toc-linux常用命令">Linux常用命令</a></li><li><a href="#网络连接命令" id="markdown-toc-网络连接命令">网络连接命令</a><ul><li><a href="#查看tcp连接状态" id="markdown-toc-查看tcp连接状态">查看TCP连接状态</a></li><li><a href="#网站日志分析" id="markdown-toc-网站日志分析">网站日志分析</a></li><li><a href="#蜘蛛分析" id="markdown-toc-蜘蛛分析">蜘蛛分析</a></li><li><a href="#数据库分析" id="markdown-toc-数据库分析">数据库分析</a></li><li><a href="#系统debug分析" id="markdown-toc-系统debug分析">系统Debug分析</a></li></ul></li><li><a href="#其他命令以及脚本代码" id="markdown-toc-其他命令以及脚本代码">其他命令以及脚本代码</a></li></ul><h3 id="工作环境设置文件与环境变量">工作环境设置文件与环境变量</h3><p><code class="language-plaintext highlighter-rouge">//</code>后面是追加注释，下同</p><p>环境设置文件有两种：系统环境设置文件和个人环境设置文件</p><blockquote><ul><li>系统中的用户工作环境设置文件</li></ul></blockquote><ol><li>登录环境设置文件：<code class="language-plaintext highlighter-rouge">/etc/profile</code>   </li><li>非登录环境设置文件：<code class="language-plaintext highlighter-rouge">/etc/bashrc</code></li></ol><blockquote><ul><li>用户个人设置的环境设置文件  <ol><li>登录环境设置文件: <code class="language-plaintext highlighter-rouge">$HOME/.bash_profile</code>   指用户登录系统后的工作环境 //这个是环境变量设置的地方</li><li>非登录环境设置文件：<code class="language-plaintext highlighter-rouge">$HOME/.bashrc</code>       指用户再调用子shell时所使用的用户环境 //这个是定义别名的地方</li></ol></li></ul></blockquote><p><code class="language-plaintext highlighter-rouge">vi ~/.bash_profile</code> 修改PATH行，把环境变量添加进去，这种方法是针对用户起作用的</p><blockquote><ul><li>命令行执行 vi ~/.bash_profile </li></ul></blockquote><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>export M2_HOME=/Users/yourName/soft/maven
export JAVA_HOME=/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home
export GRADLE_HOME=/Users/yourName/soft/gradle
export TOMCAT_HOME=/Users/yourName/soft/tomcat
export ANDROID_HOME=/Users/yourName/soft/android-sdk-macosx
export PATH=$PATH:$GRADLE_HOME/bin:$JAVA_HOME/bin:$M2_HOME/bin:$TOMCAT_HOME/bin:$ANDROID_HOME/tools:$ANDROID_HOME/platform-tools
</code></pre></div></div><p>冒号隔开；<code class="language-plaintext highlighter-rouge">$M2_HOME</code>表示引用变量；查看环境变量：<code class="language-plaintext highlighter-rouge">echo $PATH</code>；修改完刷新：<code class="language-plaintext highlighter-rouge">source ~/.bash_profile</code>，不报错则成功。</p><blockquote><ul><li>快捷设置环境变量（命令行）</li></ul></blockquote><ol><li>临时设置<code class="language-plaintext highlighter-rouge">export HOMEBREW_BOTTLE_DOMAIN=https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles</code></li><li>永久生效<code class="language-plaintext highlighter-rouge">echo -e 'export HOMEBREW_BOTTLE_DOMAIN=https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles\nexport PATH=$PATH:$HOMEBREW_BOTTLE_DOMAIN' &gt; ~/.bash_profile</code></li><li>验证 <code class="language-plaintext highlighter-rouge">wc -l ~/.bash_profile</code> //这里一定输出行数2（2 /home/yourName/.bash_profile）</li></ol><p>这里使用重定向覆盖原来的环境，这种方法一定要把$PATH带上并拼接在最前面。使用<code class="language-plaintext highlighter-rouge">&gt;</code>进行追加比较安全，然后再追加一条<code class="language-plaintext highlighter-rouge">PATH=$PATH:$HOMEBREW_BOTTLE_DOMAIN'</code></p><h3 id="linux常用命令">Linux常用命令</h3><ul><li>查找文件</li></ul><p><code class="language-plaintext highlighter-rouge">find / -name filename.txt</code> //根据名称查找/目录下的filename.txt文件</p><p><code class="language-plaintext highlighter-rouge">find . -name "*.xml"</code> //递归查找所有的xml文件</p><p><code class="language-plaintext highlighter-rouge">find . -name "*.xml" |xargs grep "hello world"</code> //递归查找所有文件内容中包含hello world的xml文件</p><p><code class="language-plaintext highlighter-rouge">grep -H 'spring' *.xml</code> //查找所以有的包含spring的xml文件</p><p><code class="language-plaintext highlighter-rouge">find ./ -size 0 | xargs rm -f &amp; </code> //删除文件大小为零的文件</p><p><code class="language-plaintext highlighter-rouge">ls -l | grep '.jar'</code> //查找当前目录中的所有jar文件</p><p><code class="language-plaintext highlighter-rouge">ls -all</code> //输出所有文件，并显示文件权限、用户、大小等</p><p><code class="language-plaintext highlighter-rouge">grep 'test' d*</code> //显示所有以d开头的文件中包含test的行</p><p><code class="language-plaintext highlighter-rouge">grep 'test' aa bb cc</code> //显示在aa，bb，cc文件中匹配test的行</p><p><code class="language-plaintext highlighter-rouge">grep '[a-z]\{5\}' aa</code> //显示所有包含每个字符串至少有5个连续小写字符的字符串的行</p><p><code class="language-plaintext highlighter-rouge">lesss fileName</code> // / 向下搜索 ？向上搜索 &amp;/ 只显示匹配模式的行</p><ul><li>查看一个程序是否运行</li></ul><p><code class="language-plaintext highlighter-rouge">ps –ef|grep tomcat</code> //查看所有有关tomcat的进程</p><p><code class="language-plaintext highlighter-rouge">ps -ef|grep --color java</code> //高亮要查询的关键字</p><ul><li>终止线程</li></ul><p><code class="language-plaintext highlighter-rouge">kill -9 19979</code> //终止线程号位19979的进程</p><ul><li>查看文件，包含隐藏文件</li></ul><p><code class="language-plaintext highlighter-rouge">ls -al</code></p><ul><li>当前工作目录</li></ul><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pwd
</code></pre></div></div><ul><li>复制文件</li></ul><p><code class="language-plaintext highlighter-rouge">cp source dest</code> //复制文件</p><p><code class="language-plaintext highlighter-rouge">cp -r sourceFolder targetFolder</code> //递归复制整个文件夹</p><p><code class="language-plaintext highlighter-rouge">scp sourecFile romoteUserName@remoteIp:remoteAddr</code> //从本地拷贝到远程</p><p><code class="language-plaintext highlighter-rouge">scp remote_username@remote_ip:remote_folder local_folder</code> //从远处复制到本地</p><ul><li>创建目录</li></ul><p><code class="language-plaintext highlighter-rouge">mkdir newfolder</code></p><ul><li>删除目录</li></ul><p><code class="language-plaintext highlighter-rouge">rmdir deleteEmptyFolder</code> //删除空目录</p><p><code class="language-plaintext highlighter-rouge">rm -rf deleteFile</code> //递归删除目录中所有内容</p><ul><li>移动文件</li></ul><p><code class="language-plaintext highlighter-rouge">mv /temp/movefile /targetFolder</code></p><ul><li>重命名命令</li></ul><p><code class="language-plaintext highlighter-rouge">mv oldNameFile newNameFile</code></p><ul><li>切换用户</li></ul><p><code class="language-plaintext highlighter-rouge">su -username</code></p><ul><li>修改文件权限</li></ul><p><code class="language-plaintext highlighter-rouge">chmod 777 file.java</code> //file.java的权限-rwxrwxrwx，r表示读、w表示写、x表示可执行</p><p><code class="language-plaintext highlighter-rouge">sudo chown -R 用户:组 ./node_modules</code> //修改文件夹./node_modules的权限</p><ul><li>压缩文件</li></ul><p><code class="language-plaintext highlighter-rouge">tar -czf test.tar.gz /test1 /test2</code></p><ul><li>列出压缩文件列表</li></ul><p><code class="language-plaintext highlighter-rouge">tar -tzf test.tar.gz</code></p><ul><li>tar解压文件</li></ul><p><code class="language-plaintext highlighter-rouge">tar -xvzf test.tar.gz</code></p><ul><li>zip命令压缩并排除某一目录</li></ul><p><code class="language-plaintext highlighter-rouge">zip -r 2019-02-12-19-30-00.zip ./ -x "./log/*"</code> //使用zip压缩文件，将当前目录的所有文件/文件夹压缩成为2019-02-12-19-30-00.zip，并且排除掉当前文件夹中的log文件夹。</p><ul><li>查看文件头10行</li></ul><p><code class="language-plaintext highlighter-rouge">head -n 10 example.txt</code></p><ul><li>统计指定文件中的字节数、字数、行数</li></ul><p><code class="language-plaintext highlighter-rouge">wc -l 文件 或 echo "xx" | wc -l</code> // -c 统计字节数，-l 统计行数， -m 统计字符数（不能与 -c 标志一起使用），-w 统计字数，-L 打印最长行的长度。</p><ul><li>查看文件尾10行</li></ul><p><code class="language-plaintext highlighter-rouge">tail -n 10 example.txt</code></p><ul><li>查看日志类型文件</li></ul><p><code class="language-plaintext highlighter-rouge">tail -f exmaple.log</code> //这个命令会自动显示新增内容，屏幕只显示10行内容的（可设置）。</p><ul><li>使用超级管理员身份执行命令</li></ul><p><code class="language-plaintext highlighter-rouge">sudo rm a.txt</code> //使用管理员身份删除文件</p><ul><li>查看端口占用情况</li></ul><p><code class="language-plaintext highlighter-rouge">netstat -tln | grep 8080</code> //查看端口8080的使用情况</p><ul><li>查看端口属于哪个程序</li></ul><p><code class="language-plaintext highlighter-rouge">lsof -i :8080</code></p><ul><li>查看进程</li></ul><p><code class="language-plaintext highlighter-rouge">ps aux|grep java</code> //查看java进程</p><p><code class="language-plaintext highlighter-rouge">ps aux</code> //查看所有进程</p><ul><li>以树状图列出目录的内容</li></ul><p><code class="language-plaintext highlighter-rouge">tree a</code></p><p>在Mac OSX 系统默认是没有类似windows中的 tree命令，找到一条比较有意思的命令可以实现： <code class="language-plaintext highlighter-rouge">find . -print | sed -e 's;[^/]*/;|____;g;s;____|; |;g'</code></p><p>为了方便使用，写一个alias 到~/.profile里: <code class="language-plaintext highlighter-rouge">alias tree="find . -print | sed -e 's;[^/]*/;|____;g;s;____|; |;g'"</code>写完记得<code class="language-plaintext highlighter-rouge">source ~/.profile</code></p><ul><li>文件下载</li></ul><p><code class="language-plaintext highlighter-rouge">wget http://file.tgz</code>  //mac下安装wget命令</p><p><code class="language-plaintext highlighter-rouge">curl http://file.tgz</code> //一般都有curl</p><ul><li>网络检测</li></ul><p><code class="language-plaintext highlighter-rouge">ping www.just-ping.com</code> //加参数-t表示持续进行</p><ul><li>查看IP和MAC地址</li></ul><p>Windows：<code class="language-plaintext highlighter-rouge">ipconfig</code> Mac/Linux：<code class="language-plaintext highlighter-rouge">ifconfig</code> // 额外参数自查</p><p>PS：注意255结尾的IP是Broadcast address，不要误以为这个是IP。</p><ul><li>远程登录</li></ul><p><code class="language-plaintext highlighter-rouge">ssh userName@ip</code></p><ul><li>Linux切换用户</li></ul><p><code class="language-plaintext highlighter-rouge">sudo su -l root</code> //已登录用户切换到root</p><ul><li>登录并执行命令</li></ul><p>shell：<code class="language-plaintext highlighter-rouge">ssh userName@ip "ls"</code> //注意shell脚本中双引号有时候很必要</p><ul><li><code class="language-plaintext highlighter-rouge">&gt;&gt;</code>和<code class="language-plaintext highlighter-rouge">&gt;</code>重定向命令</li></ul><p><code class="language-plaintext highlighter-rouge">&gt;</code> 是定向输出到文件，如果文件不存在，就创建文件；如果文件存在，就将其清空；一般我们备份清理日志文件的时候，就是这种方法：先备份日志， 再用 <code class="language-plaintext highlighter-rouge">&gt;</code>，将日志文件清空（文件大小变成0字节）。</p><p><code class="language-plaintext highlighter-rouge">&gt;&gt;</code> 这个是将输出内容追加到目标文件中。如果文件不存在，就创建文件；如果文件存在，则将新的内容追加到那个文件的末尾，该文件中的原有内容不受影响</p><p>Linux中有三种标准输入输出，分别是 STDIN，STDOUT，STDERR，对应的数字是 0，1，2。由于STDOUT与STDERR都会默认显示在终端上，为了区分二者的信息， 就有了编号的0，1，2的定义，用1表示STDOUT，2表示STDERR。 有时候希望将错误的信息重新定向到输出，就是将2的结果重定向至1中就有了”2&gt;1”这样的思路，如果按照上面的写法， 系统会默认将错误的信息（STDERR）2重定向到一个名字为1的文件中，而非所想的（STDOUT）中。因此需要加&amp;进行区分。就有了 2&gt;&amp;1 这样的用法。 这种比单独重定向效率高，具体原因参考下面参考2。</p><p>平常输出日志用的最多的<code class="language-plaintext highlighter-rouge">sh test.sh &gt; test.log 2&gt;&amp;1 &amp;</code> 意思是：执行test脚本，并将标准错误也输出到标准输出当中，最后一个&amp;表示在后台执行。</p><ul><li>统计本目录下所有Java和Scala文件的数量</li></ul><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>echo -e $(find . -name "*.scala" | wc -l)\\n$(find . -name "*.java" | wc -l) | awk '{a+=$1}END{print a}'
</code></pre></div></div><ul><li>查找本目录下所有Scala文件并显示详细文件信息</li></ul><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>find ./ -name '*.scala' | xargs ls -all
</code></pre></div></div><ul><li>查找本目录下所有Scala文件，并执行一些操作</li></ul><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>find ./ -name '*.scala' -exec ls -all {} \; //执行ls -all 显示所有详细信息
</code></pre></div></div><p><code class="language-plaintext highlighter-rouge">which</code> //可执行文件名称（which是通过 PATH环境变量到该路径内查找可执行文件，所以基本的功能是寻找可执行文件 ） <code class="language-plaintext highlighter-rouge">whereis</code> //文件或者目录名称（从数据库文件中查找，不是实时更新） <code class="language-plaintext highlighter-rouge">whoami</code> //显示自身的用户名称，本指令相当于执行 id -un 指令</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>whoami 与 who am i的区别
who这个命令重点在用来查看当前有那些用户登录到了本台机器上
who -m的作用和who am i的作用是一样的
who am i显示的是实际用户的用户名，即用户登陆的时候的用户ID。此命令相当于who -m
whoami显示的是有效用户ID ，是当前操作用户的用户名
</code></pre></div></div><ul><li>sed命令</li></ul><p><a href="2018-11-11-常用命令-sed命令.md">sed详细介绍</a></p><ul><li>vim命令</li></ul><p><a href="2018-11-11-常用命令-vim命令.md">vim命令总结</a></p><h3 id="网络连接命令">网络连接命令</h3><h4 id="查看tcp连接状态">查看TCP连接状态</h4><ul><li>统计多种状态的网络连接数</li></ul><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>netstat -n | awk '/^tcp/ {++state[$NF]}; END {for(key in state) print key, state[key]}'

注释
/^tcp/: 滤出tcp开头的记录，屏蔽udp,socket等无关记录。
state[]: 相当于定义了一个名叫state的数组NF
NF: 表示记录的字段数，如上所示的记录，NF等于6
$NF: 表示某个字段的值，如上所示的记录，$NF也就是$6，表示第6个字段的值，也就是TIME_WAIT
state[$NF] 表示数组元素的值，如上所示的记录，就是state[TIME_WAIT]状态的连接数
++state[$NF]表示把某个数加一，如上所示的记录，就是把state[TIME_WAIT]状态的连接数加一
END 表示在最后阶段要执行的命令
for(key in state) 遍历数组 print key,"\t",state[key] 打印数组的键和值，中间用\t制表符分割，美化一下
</code></pre></div></div><ul><li>查找请求数请20个IP（常用于查找攻来源）</li></ul><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>netstat -ant | grep "192.168.1.109" | awk '{print $5}' | awk -F: '{print $1}'| uniq -c | sort -nr | head -20
</code></pre></div></div><ul><li>用tcpdump嗅探80端口的访问</li></ul><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcpdump -i eth0 -tnn dst port 80-c 1000
</code></pre></div></div><ul><li>查找较多time_wait连接</li></ul><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>netstat -ant | awk '/TIME_WAIT/ {print $5}' | sort | uniq -c | sort -nr | head -20
</code></pre></div></div><ul><li>根据端口列进程</li></ul><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>netstat -ntlp |grep 80|awk '{print $7}'|cut -d/-f1
</code></pre></div></div><h4 id="网站日志分析">网站日志分析</h4><ul><li>获得访问前10位的ip地址</li></ul><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat /opt/logs/nginx-access.log | awk '{print $1}' | sort | uniq -c | sort -nr | head -n10
cat /opt/logs/nginx-access.log | awk '{counts[$(11)]+=1}; END {for(url in counts) print counts[url], url}'
</code></pre></div></div><ul><li>访问次数最多的文件或页面,取前20</li></ul><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat /opt/log/nginx-access.log | awk '{print $11}' | sort | uniq -c | sort -nr | head -20
</code></pre></div></div><ul><li>列出传输最大的几个exe文件（分析下载站的时候常用）</li></ul><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat /opt/log/nginx-access.log |awk '($7~/\.exe/){print $10 " " $1 " " $4 " " $7}'|sort -nr|head -20
</code></pre></div></div><ul><li>列出输出大于200000byte(约200kb)的exe文件以及对应文件发生次数</li></ul><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat /opt/log/nginx-access.log |awk '($10 &gt; 200000 &amp;&amp; $7~/\.exe/){print $7}'|sort -n|uniq -c|sort -nr|head -100
</code></pre></div></div><ul><li>列出最最耗时的页面(超过60秒的)的以及对应页面发生次数</li></ul><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat /opt/log/nginx-access.log |awk '($NF &gt; 60 &amp;&amp; $7~/\.php/){print $7}'|sort -n|uniq -c|sort -nr|head -100
</code></pre></div></div><ul><li>列出传输时间超过 30 秒的文件</li></ul><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat /opt/log/nginx-access.log |awk '($NF &gt; 30){print $7}'|sort -n|uniq -c|sort -nr|head -20
</code></pre></div></div><ul><li>统计网站流量（G)</li></ul><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat /opt/log/nginx-access.log |awk '{sum+=$10} END {print sum/1024/1024/1024}
</code></pre></div></div><ul><li>统计404的连接</li></ul><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>awk '($9 ~/404/)'/opt/log/nginx-access.log |awk '{print $9,$7}'|sort
</code></pre></div></div><ul><li>统计http status</li></ul><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat /opt/log/nginx-access.log |awk '{counts[$(9)]+=1}; END {for(code in counts) print code, counts[code]}'
cat /opt/log/nginx-access.log |awk '{print $9}'|sort|uniq -c|sort -rn
cat /opt/logs/nginx-access.log | awk '{if($9~/200|30|404/) COUNT[$7]++} END {for( a in COUNT) print a,COUNT[a]}' | sort -k 2 -n -r | head -n20
</code></pre></div></div><ul><li>每秒并发</li></ul><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat /opt/logs/nginx-access.log | grep '18/Dec/2017:18:25' | wc -l | awk '{print $1/60}'
</code></pre></div></div><h4 id="蜘蛛分析">蜘蛛分析</h4><ul><li>查看是哪些蜘蛛在抓取内容</li></ul><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcpdump -i eth0 -l -s 0-w -dst port 80 | strings | grep -i user-agent |grep -i -E 'bot|crawler|slurp|spider'
</code></pre></div></div><h4 id="数据库分析">数据库分析</h4><ul><li>查看数据库执行的sql</li></ul><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcpdump -i eth0 -s 0-l -w -dst port 3306|strings |egrep -i 'SELECT|UPDATE|DELETE|INSERT|SET|COMMIT|ROLLBACK|CREATE|DROP|ALTER|CALL'
</code></pre></div></div><h4 id="系统debug分析">系统Debug分析</h4><ul><li>调试命令</li></ul><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>strace -p pid
</code></pre></div></div><ul><li>跟踪指定进程的PID</li></ul><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gdb -p pid
</code></pre></div></div><h3 id="其他命令以及脚本代码">其他命令以及脚本代码</h3><ul><li>java 常用命令</li></ul><p>java, javac, <a href="http://www.hollischuang.com/archives/105">jps</a>, <a href="http://www.hollischuang.com/archives/481">jstat</a>, <a href="http://www.hollischuang.com/archives/303">jmap</a>, <a href="http://www.hollischuang.com/archives/110">jstack</a></p><ul><li>统计jstack中各个状态的线程数量，slick-dead: 线程堆栈文件</li></ul><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>awk -F: '/java.lang.Thread.State/ {c[$2]++}; END {for(t in c) print t, c[t]}' slick-dead | sort -rn -k 2
</code></pre></div></div><ul><li>输出</li></ul><p><code class="language-plaintext highlighter-rouge">var=$(echo 1)</code> //获取echo输出的值，并赋值给变量；或使用<code class="language-plaintext highlighter-rouge">``</code></p><p><code class="language-plaintext highlighter-rouge">awk '{print $2}' $fileName</code> //一行一行的读取指定的文件， 以空格作为分隔符，打印第二个（列）字段</p><ul><li>发送curl，并判断返回值是否为空</li></ul><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#返回类型：application/json get
result=$(curl-G http://www.ss.com)
if [! -n "$result" ];then
	echo"成功！"
else
	echo $result
fi 
</code></pre></div></div><ul><li>Mac获取当前时间戳</li></ul><p><code class="language-plaintext highlighter-rouge">date +%s</code> 赋值<code class="language-plaintext highlighter-rouge">CURRENT_TIME=$(date+%s)</code></p><ul><li>Mac显示隐藏文件夹</li></ul><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>defaults write com.apple.finder AppleShowAllFiles -bool true;
KillAll Finder
</code></pre></div></div><ul><li>Mac查看当前目录下面所有文件夹所占的空间</li></ul><p><code class="language-plaintext highlighter-rouge">du -h -d 1</code> //1表示当前层级（一级目录）</p><ul><li>后台进程</li></ul><p>在后台启动 <code class="language-plaintext highlighter-rouge">sh test.sh &amp;</code> //前面加nohup 不挂断地运行命令</p><p>进程切换到后台的时候，我们把它称为job。切换到后台时会输出相关job信息，<br /> 以前面的输出为<code class="language-plaintext highlighter-rouge">[1] 11319 [1]表示job ID是1，11319表示进程ID是11319。切换到后台的进程，仍然可以用ps命令查看。</code>   前后台间切换可以通过<code class="language-plaintext highlighter-rouge">bg &lt;jobid&gt; (background)</code>和<code class="language-plaintext highlighter-rouge">fg&lt;jobid&gt;()foreground)</code>命令将其在前后台间状态切换。</p><ul><li>字符串操作</li></ul><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>var=$(echo "a b (c d)") //用echo的输出赋值给变量
var2=$(echo $var | tr -d " ") //去掉var字符串的空格：ab(cd)
var3=$(echo $var2 | cut -d '(' -f2 | cut -d ')' -f1) // 获取字符串var2中括号()之间的字符串：cd
echo $var3 //最后输出：cd
</code></pre></div></div><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ipPort="192.168.1.1:80"
ipAddr=${ipPort/:/ } //去掉IP:port中的冒号：
</code></pre></div></div><ul><li>比较文件</li></ul><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>比较二进制文件 cmp good.jpg bad.jpg （输出在多少行开始有差异）
文本文件比较 diff good.log bad.log  -y -W 50
以不可读字符来对比 vimdiff good.jpg bad.jpg
将二进制转为以16进制字符来对比 diff -y &lt;(xxd good.jpg) &lt;(xxd bad.jpg )
安装彩色  brew install colordiff （Mac上）    
实验彩色对比 colordiff -y &lt;(xxd good.jpg) &lt;(xxd bad.jpg)
打开文件 vim good.jpg（垂直分割打开第二个文件）， vsplit good.jpg（水平分割 vsplit good.jpg）
16进制输出模式  % !xxd
显示行号 set number
</code></pre></div></div><ul><li>解决ssh无法链接localhost</li></ul><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh-keygen -t dsa -P '' -f ~/.ssh/id_dsa  
cat ~/.ssh/id_dsa.pub &gt;&gt; ~/.ssh/authorized_keys
</code></pre></div></div><ul><li>关闭本机端口占用</li></ul><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/bin/bash

set -x

port=${1}

lsof -i:$port | awk '{print $2}' | sed -n '2p' | xargs kill -9
</code></pre></div></div><p>可增加命令别名方便执行</p><p>持续更新中。。。</p><p>参考</p><p><a href="http://www.hollischuang.com/archives/239">Linux端口被占用的解决(Error: JBoss port is in use. Please check</a></p><p><a href="https://linux.cn/article-1672-1.html">linux 中强大且常用命令：find、grep</a></p><p><a href="http://www.hollischuang.com/archives/548">mac下安装wget命令</a></p><p><a href="https://www.cnblogs.com/kex1n/p/5216932.html">linux的whoami, who指令</a></p><p><a href="https://blog.csdn.net/c19870525/article/details/80756121">csdn参考</a></p><p><a href="https://www.cnblogs.com/is-Tina/p/8697299.html">cnblogs参考</a></p><p><a href="https://wtog.github.io/2019/04/11/jstack.html">jstack 解读</a></p><p><a href="https://wtog.github.io/2019/04/04/network-statistics.html">网络连接状态统计</a></p><div style="margin-top:2em;padding:0 1.5em;border:1px solid #d3d3d3;background-color:#deebf7"><h3>文档信息</h3><ul><li>本文作者：<a href="https://blog.dreamylost.cn" target="_blank">梦境迷离</a></li><li>本文链接：<a href="https://blog.dreamylost.cn/wiki/Linux%E5%91%BD%E4%BB%A4/" target="_blank">https://blog.dreamylost.cn/wiki/Linux%E5%91%BD%E4%BB%A4/</a></li><li>版权声明：自由转载-非商用-非衍生-保持署名（<a href="http://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh" target="_blank">创意共享3.0许可证</a>）</li></ul></div></article><div class="share"></div><div class="comment"><div id="gitalk-container"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jxnu-liguobin/jxnu-liguobin.github.io@master/assets/vendor/gitalk/gitalk.css"> <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script> <script> var gitalk = new Gitalk({ id: '/wiki/Linux%E5%91%BD%E4%BB%A4/', clientID: '061aadb5d449c0877d7d', clientSecret: '9aa7af7c248a7e36a07a86993e11a7acf7fbd353', repo: 'dreamylost-comments', owner: 'jxnu-liguobin', admin: ['jxnu-liguobin'], labels: ['gitment'], perPage: 50, }); gitalk.render('gitalk-container'); </script></div></div><div class="column one-fourth"><h3>Search</h3><div id="site_search"> <input style="width:96%" type="text" id="search_box" placeholder="Search"></div><ul id="search_results" style="font-size:14px;list-style-type:none;padding-top:10px;padding-left:10px;"></ul><script src="https://cdn.jsdelivr.net/gh/jxnu-liguobin/jxnu-liguobin.github.io@master/assets/js/simple-jekyll-search.min.js"></script> <script type="text/javascript"> SimpleJekyllSearch({ searchInput: document.getElementById('search_box'), resultsContainer: document.getElementById('search_results'), json: 'https://cdn.jsdelivr.net/gh/jxnu-liguobin/jxnu-liguobin.github.io@built/assets/search_data.json?v=1702960690', searchResultTemplate: '<li><a href="{url}" title="{title}">{title}</a></li>', noResultsText: 'No results found', limit: 10, fuzzy: false, exclude: ['Welcome'] }) </script><h3 class="post-directory-title mobile-hidden">Table of Contents</h3><div id="post-directory-module" class="mobile-hidden"><section class="post-directory"><dl></dl></section></div><script src="https://cdn.jsdelivr.net/gh/jxnu-liguobin/jxnu-liguobin.github.io@master/assets/js/jquery.toc.js"></script></div></div></section><footer class="container"> <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-8236444920328818" data-ad-slot="6220614560" data-ad-format="auto" data-full-width-responsive="true"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script><div class="site-footer" role="contentinfo"><div class="copyright left mobile-block"> © 2019 <span title="梦境迷离">梦境迷离</span> <a href="javascript:window.scrollTo(0,0)" class="right mobile-visible">TOP</a></div><ul class="site-footer-links right mobile-hidden"><li> <a href="javascript:window.scrollTo(0,0)" >TOP</a></li></ul><a href="https://github.com/jxnu-liguobin/jxnu-liguobin.github.io" target="_blank" aria-label="view source code"> <span class="mega-octicon octicon-mark-github" title="GitHub"></span> </a><ul class="site-footer-links mobile-hidden"><li> <a href="https://blog.dreamylost.cn/" title="首页" target="">首页</a></li><li> <a href="https://blog.dreamylost.cn/categories/" title="分类" target="">分类</a></li><li> <a href="https://blog.dreamylost.cn/archives/" title="归档" target="">归档</a></li><li> <a href="https://blog.dreamylost.cn/open-source/" title="开源" target="">开源</a></li><li> <a href="https://blog.dreamylost.cn/wiki/" title="维基" target="">维基</a></li><li> <a href="https://blog.dreamylost.cn/links/" title="链接" target="">链接</a></li><li> <a href="https://blog.dreamylost.cn/about/" title="关于" target="">关于</a></li><li><a href="https://blog.dreamylost.cn/feed.xml"><span class="octicon octicon-rss" style="color:orange;"></span></a></li></ul><script async src="https://cdn.jsdelivr.net/gh/jxnu-liguobin/jxnu-liguobin.github.io@master/assets/vendor/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="mobile-hidden" style="margin-top:8px"> <span id="busuanzi_container_site_pv" style="display:none"> 本站访问量<span id="busuanzi_value_site_pv"></span>次 </span> <span id="busuanzi_container_site_uv" style="display:none"> / 本站访客数<span id="busuanzi_value_site_uv"></span>人 </span> <span id="busuanzi_container_page_pv" style="display:none"> / 本页访问量<span id="busuanzi_value_page_pv"></span>次 / 统计始于2019-09-20 </span></div></div></footer><div class="tools-wrapper"> <a class="gotop" href="#" title="回到顶部"><span class="octicon octicon-arrow-up"></span></a></div><script src="https://cdn.jsdelivr.net/gh/jxnu-liguobin/jxnu-liguobin.github.io@master/assets/js/geopattern.js"></script> <script> jQuery(document).ready(function($) { $('.geopattern').each(function(){ $(this).geopattern($(this).data('pattern-id')); }); /* hljs.initHighlightingOnLoad(); */ }); </script><div style="display:none"> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','https://www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-147390701-1', 'auto'); ga('send', 'pageview'); </script></div></body></html>
